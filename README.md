# Тестовое задание для vk

# Описание:
Нужно написать упрощенную систему выполнения абстрактных заказов.

Есть заказчики, исполнители и система.
Заказчик публикует заказ, указывает его стоимость.
Исполнитель видит ленту заказов, доступных для исполнения.
Исполнитель кликает "выполнить" на заказе, ему на счет зачисляется сумма за вычетом комиссии системы.
У одного заказа может быть только один исполнитель. Когда заказ выполнен - он исчезает из ленты.

# Техника:
PHP (без ООП), mysql, клиентская сторона на усмотрение. Проект должен быть на гитхабе и отражать процесс разработки.

Код максимально приближенный к боевому, в частности предусмотреть вариант, когда каждая таблица располагается в отдельной базе данных.

Клиентская сторона максимально "аджаксифицирована" и поприятнее.

В результате — ссылка на гитхаб и развёрнутое демо.

Сроки на ваше усмотрение

Мы смотрим на безопасность кода, основательность подхода, целостность данных, расчет на нагрузку


# Архитектура:
- common (содержит общие функции)
- modules (подключаемые модули в зависимости от URL)
- views (ошибки и заглушки, что строятся и PHP)
- www_dynamic (тут будет PHP часть, размещаю ее на Nginx без реврайтов, то есть все запросы с морды будут идти только в index.php с параметрами)
- www_static (тут будет HTML/AngularJs часть, т.к. это статика - размещаю на Nginx.)

# Деплой
- http://static.vk.dchistyakov.ru (морда тут)
- http://dynamic.vk.dchistyakov.ru (для AJAX запросов)

# Ремарки
- Для входа под заказчикам в логине вводим: customer
- Для входа под исполнителем в логине вводим: executor
- Под системой нельзя войти, хотя этот тоже юзер с Id 1.

# БД
Создал 5 БД, в каждой по табличке:

> vk_users (пользователи)
- user (InnoDB) - т.к. финансовые операции требуют транзакций
табличка где живут пользователи, у них есть роли (user,system) для того, что бы финансовая система была замкнута)

> vk_sessions (сессии)
- session (Memory) - поставил мемори, из расчета на 1 млн сессий ~ 450 мб. Сессией считается логин.
хоть в задании и не обозначено ничего по поводу регистрации и логина, все же сделаю базовый функционал, все лучше чем смена пользователей по "клику"

> vk_orders (заказы)
- order (InnoDB) - т.к. учавствует в фин. транзакции
тут живут задания
- update (триггер on update, следит за изменение статусов заданий и кладет логи в vk_log.order_status

> vk_transactions (сами транзакции)
- transaction (InnoDB)
Накопительная табличка для обеспечения целостности данных. В любой момент позволит откатить ту или иную транзакцию или посмотреть историю.

> vk_log (лог перехода заданий по статусам, если не пройдет транзакция или еще что)
- order_status (InnoDB)
Накопительная, пополняется триггером

# Логика моста static => dynamic
- Пользователь заходит на статик, видит форму логина и логинится. Система делает пост запрос к динамику и далее если получает куку - пускает юзера в бекенд морды. Для скорости поставил отслеживание по куке на angular.
- Статик осуществляет раз в какое-то время контрольные запросы к динамик - например для того, что бы если истекла сессия перекинуть юзера на окошко логина или скрин лока, а так же обновлять баланс если идут выполнения заданий.
- Далее любой запрос по мосту исполняется ожидая получить JSON данные для работы в angular.

# Морда
Хотел как быстрее и красивее и решил заюзать шаблон метроник, в итоге умер его чистить от нон-ангулар-вей шлака. Чувствую зря шаблониться решил, но уже ничего не поделаешь, по этому доделываю как есть. В итоге поднят angularjs 1.4.3 + metronic админ шаблон, лайоут 4.

# Итог
Перед смертью, конечно, не надышишься, но все же отмечу, что несмотря на "Код максимально приближенный к боевому" в задании, все же данный код является лишь демонстрацией мышления и навыков) Подход выбрал такой т.к. хотел, что бы система максимально масшабировалась при этом потребляла мимимум ресурсов и траффика. По сути тут сплошной JS, который можно закешировать браузером один раз. С PHP обмен данным через JSON (не стал морочиться с кодировнием, но умею). В общем хватит болтать, сдаюсь. :)

P.S.:
Все же допишу, понимаю, что шабло в 10 мб - это много, но еще раз оговорюсь - я просто взял готовый. Его при необходимости можно вычистить и перевести на внешние источники скриптов.. и т.п.